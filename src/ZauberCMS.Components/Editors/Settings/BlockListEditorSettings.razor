@using ZauberCMS.Components.Editors.Models
@using ZauberCMS.Core.Content.Parameters
@implements ZauberCMS.Core.Content.Interfaces.IContentPropertySettings<BlockListEditorSettingsModel>

<EditorRow>
    <LeftColumn>
        <PropertyInfo Name="Stylesheets" Description="Add the stylesheets needed for this block list editor (Path should be relative to the website root i.e. '/css/styles.css')"/>
    </LeftColumn>
    <CentreColumn>
        <ListEditor TItem="string" @bind-Value="@Settings.Styleheets" />
    </CentreColumn>
</EditorRow>

<EditorRow>
    <LeftColumn>
        <PropertyInfo Name="Allowed Element Types" Description="Select which element types can be used in this block list. If none are selected, all element types will be available."/>
    </LeftColumn>
    <CentreColumn>
            <RadzenListBox @bind-Value="@Settings.AllowedElementTypeIds"
                           Data="@ElementTypes"
                           FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                           FilterOperator="StringFilterOperator.StartsWith"
                           AllowFiltering="true"
                           TextProperty="Name"
                           ValueProperty="Id"
                           Multiple="true"
                           AllowClear="true"
                           Placeholder="Select Element Types"
                           Style="width: 100%; height: 250px"
                           InputAttributes="@(new Dictionary<string, object> { { "aria-label", "select element types" } })"/>
    </CentreColumn>
</EditorRow>

<RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.Right" AlignItems="AlignItems.Center" class="rz-mt-3">
    <RadzenButton ButtonType="ButtonType.Submit" ButtonStyle="ButtonStyle.Success" Text="Store Settings" Click="Save"/>
</RadzenStack>


@code {
    [Parameter] public string? SettingsModel { get; set; }
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    public BlockListEditorSettingsModel Settings { get; set; } = new();

    private List<ContentType> ElementTypes { get; set; } = [];

    protected override async Task OnInitializedAsync()
    {
        Settings = this.GetPropertySettings();

        // Load all element types
        var result = await ContentService.QueryContentTypesAsync(new QueryContentTypesParameters
        {
            AmountPerPage = 1000,
            OnlyElementTypes = true,
            OrderBy = GetContentTypesOrderBy.Name
        });

        ElementTypes = result.Items.ToList();
    }

    private async Task Save()
    {
        await this.SavePropertySettings(Settings);
    }
}