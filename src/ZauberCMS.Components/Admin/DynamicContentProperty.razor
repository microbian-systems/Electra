@using ZauberCMS.Core.Content.Models

<CascadingValue Value="this">
    <DynamicComponent Type="@ComponentType" Parameters="@GetParameters()"/>
</CascadingValue>

@code {
    [Parameter] public Type? ComponentType { get; set; }
    [Parameter] public string Value { get; set; } = string.Empty;
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    [Parameter] public string Settings { get; set; } = string.Empty;
    [Parameter] public Content? Content { get; set; }
    [Parameter] public Action<BlockListChanges>? ChangesPending { get; set; }
    [Parameter] public string? PropertyAlias { get; set; }

    private Dictionary<string, object> GetParameters()
    {
        var parameters = new Dictionary<string, object>
        {
            ["Value"] = Value,
            ["ValueChanged"] = ValueChanged,
            ["Settings"] = Settings,
            ["Content"] = Content!
        };

        // Add ChangesPending callback only for BlockListEditor
        if (ChangesPending != null && ComponentType?.Name == "BlockListEditorProperty")
        {
            parameters["ChangesPending"] = ChangesPending;
        }
        
        // Add PropertyAlias if provided and the component supports it
        // Check if the component type has a PropertyAlias property before adding it
        if (!string.IsNullOrWhiteSpace(PropertyAlias) && ComponentType != null)
        {
            var hasPropertyAliasParameter = ComponentType.GetProperty("PropertyAlias") != null;
            if (hasPropertyAliasParameter)
            {
                parameters["PropertyAlias"] = PropertyAlias;
            }
        }

        return parameters;
    }
}