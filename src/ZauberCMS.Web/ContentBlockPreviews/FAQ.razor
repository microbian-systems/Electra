@using ZauberCMS.Web.ContentBlocks
@implements ZauberCMS.Core.Content.Interfaces.IContentBlockPreview
@if (Content != null)
{
    @if (FaqItems.Any())
    {
        @foreach (var faq in FaqItems)
        {
            <div>
                <h2>@(faq.GetValue<string>("Question"))</h2>
                <RTEBlock Content="@faq" PropertyName="Answer" />
            </div>
        }
    }
    else
    {
        <div class="border border-gray-200 rounded p-4 bg-gray-50">
            <div class="flex items-center space-x-2">
                <span class="text-lg font-medium">FAQ Block</span>
                <span class="text-sm text-gray-600">(@ExpectedCount item@(ExpectedCount == 1 ? "" : "s"))</span>
            </div>
            <div class="mt-2 text-sm text-gray-500 italic">
                @if (ExpectedCount > 0)
                {
                    <text>Add FAQ items to see them here</text>
                }
                else
                {
                    <text>No FAQ items added yet</text>
                }
            </div>
        </div>
    }
}

@code {
    [Parameter] public Content? Content { get; set; }
    [Parameter] public ContentType? ContentType { get; set; }
    public string ContentTypeAlias => "FAQ";

    private IEnumerable<Content> FaqItems { get; set; } = [];
    private int ExpectedCount { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        if (Content != null)
        {
            // Get expected count from PropertyData (reads current in-memory state)
            var faqIds = Content.GetValue<List<Guid>>("FAQs");
            ExpectedCount = faqIds?.Count ?? 0;
            
            // Load FAQ items with pending changes included for live preview
            FaqItems = await Content.GetBlocks("FAQs", ContentService, includePendingChanges: true);
        }
        else
        {
            FaqItems = [];
            ExpectedCount = 0;
        }
    }
}