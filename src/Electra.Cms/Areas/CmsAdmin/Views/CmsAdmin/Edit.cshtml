@model PageEditViewModel
@using System.Text.Json
@{
    ViewData["Title"] = $"Edit Page - {Model.Page.Metadata.Title}";
    var isNew = string.IsNullOrEmpty(Model.Page.Id) || Model.Page.Id.EndsWith("/");
    var blocksJson = JsonSerializer.Serialize(Model.Page.Blocks, new JsonSerializerOptions { WriteIndented = true });
}

<div class="container mx-auto px-4 py-8">
    <div class="mb-6">
        <nav class="text-sm font-medium mb-2" aria-label="Breadcrumb">
            <ol class="list-none p-0 inline-flex">
                <li class="flex items-center">
                    <a asp-action="Index" class="text-blue-600 hover:text-blue-900">Sites</a>
                    <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                </li>
                <li class="flex items-center">
                    <a asp-action="Pages" asp-route-siteId="@Model.Site.Id" class="text-blue-600 hover:text-blue-900">@Model.Site.Name Pages</a>
                    <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                </li>
                <li>
                    <span class="text-gray-500">@(isNew ? "New Page" : "Edit Page")</span>
                </li>
            </ol>
        </nav>
        <h1 class="text-3xl font-bold">@(isNew ? "Create New Page" : $"Edit: {Model.Page.Metadata.Title}")</h1>
    </div>

    <form asp-action="Save" asp-route-pageId="@(isNew ? "new" : Model.Page.Id)" method="post" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
        <input type="hidden" name="SiteId" value="@Model.Page.SiteId" />
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="Title">
                    Page Title
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                       id="Title" name="Metadata.Title" type="text" value="@Model.Page.Metadata.Title" required>
            </div>
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="Slug">
                    Slug
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                       id="Slug" name="Slug" type="text" value="@Model.Page.Slug" required>
            </div>
        </div>

        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="FullUrl">
                Full URL Path
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                   id="FullUrl" name="FullUrl" type="text" value="@Model.Page.FullUrl" placeholder="/my-page" required>
        </div>

        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="SeoDescription">
                SEO Description
            </label>
            <textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                      id="SeoDescription" name="Metadata.SeoDescription" rows="3">@Model.Page.Metadata.SeoDescription</textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="Template">
                    Template
                </label>
                <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                        id="Template" name="Template">
                    <option value="default" selected="@(Model.Page.Template == "default")">Default</option>
                    <option value="fullwidth" selected="@(Model.Page.Template == "fullwidth")">Full Width</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="PublishedState">
                    Status
                </label>
                <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                        id="PublishedState" name="PublishedState">
                    <option value="Draft" selected="@(Model.Page.PublishedState == PagePublishedState.Draft)">Draft</option>
                    <option value="Published" selected="@(Model.Page.PublishedState == PagePublishedState.Published)">Published</option>
                    <option value="Archived" selected="@(Model.Page.PublishedState == PagePublishedState.Archived)">Archived</option>
                </select>
            </div>
        </div>

        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2">
                Page Content (Blocks JSON)
            </label>
            <p class="text-xs text-gray-500 mb-2 font-normal italic">Edit the JSON representation of blocks directly for now.</p>
            <textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline font-mono text-sm" 
                      id="BlocksJson" name="BlocksRaw" rows="15">@blocksJson</textarea>
            @* Note: We'll need code in the controller to parse this JSON back to List<BlockDocument> *@
        </div>

        <div class="flex items-center justify-between">
            <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:shadow-outline" type="submit">
                Save Page
            </button>
            <a asp-action="Pages" asp-route-siteId="@Model.Site.Id" class="inline-block align-baseline font-bold text-sm text-blue-600 hover:text-blue-800">
                Cancel
            </a>
        </div>
    </form>
</div>